<!-- templates/bid.html -->
<!DOCTYPE html>
<html>

<head>
    <title>Bonaventura</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/background_color.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/contact-718.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/cs-button-6.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/footer.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/gallery-45.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/header.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/hero-82.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/hero-408.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/property-grid.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/services.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/table.css') }}">
    <script src="{{ url_for('static', filename='js/header.js') }}"></script>
    <script>
        function formatPhoneNumber(phoneNumber) {
            const cleaned = ('' + phoneNumber).replace(/\D/g, '');
            const match = cleaned.match(/^(\d{3})(\d{3})(\d{4})$/);
            if (match) {
                return '(' + match[1] + ') ' + match[2] + '-' + match[3];
            }
            return null;
        }

        window.onload = function () {
            const phoneInput = document.getElementById('phone');
            if (phoneInput) {
                phoneInput.addEventListener('input', function (e) {
                    const formatted = formatPhoneNumber(e.target.value);
                    e.target.value = formatted ? formatted : e.target.value;
                });

                // Apply initial formatting
                phoneInput.value = formatPhoneNumber(phoneInput.value);
            }

            updateTotalAmount();
        };
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Function to calculate and update fee
            function updateFee() {
                // Get the maximum bid amount entered by the user
                var maxBidAmount = parseFloat(document.getElementById('maximum-bid-amount').value.replace(/[^0-9.-]+/g, "")) || 0;
                // Calculate the fee as 20% of the maximum bid amount
                var fee = maxBidAmount * 0.20;
                // Update the fee field with the calculated fee, formatting as currency
                document.getElementById('fee').value = fee.toFixed(2);
            }
        
            // Event listener for changes in the maximum bid amount field
            document.getElementById('maximum-bid-amount').addEventListener('input', updateFee);
        
            // Initial calculation in case there's a default value
            updateFee();
        });
        </script>
        <script>
            document.getElementById('bid-form').addEventListener('submit', function(event) {
                var openingBid = parseFloat(document.getElementById('maximum-bid-amount').getAttribute('min'));
                var currentBid = parseFloat(document.getElementById('maximum-bid-amount').value);
                
                if (currentBid < openingBid) {
                    event.preventDefault(); // Stop the form submission
                    alert('Your bid must be at least the opening bid amount.');
                }
            });
        </script>
        



</head>

<body>

    <div class="wrapper">
        <header id="cs-navigation">
            <div class="cs-container">
                <!--Nav Logo-->
                <a href="{{ url_for('home') }}" class="cs-logo" aria-label="back to home">
                    <img src="{{ url_for('static', filename='images/background.jpg') }}" alt="logo" width="210"
                        height="29" aria-hidden="true" decoding="async">
                </a>
                <!--Navigation List-->
                <nav class="cs-nav" role="navigation">
                    <!--Mobile Nav Toggle-->
                    <button class="cs-toggle" aria-label="mobile menu toggle">
                        <div class="cs-box" aria-hidden="true">
                            <span class="cs-line cs-line1" aria-hidden="true"></span>
                            <span class="cs-line cs-line2" aria-hidden="true"></span>
                            <span class="cs-line cs-line3" aria-hidden="true"></span>
                        </div>
                    </button>
                    <div class="cs-ul-wrapper">
                        {% if session['user_role'] == 1 or session['user_role'] == 2 %}
                        <ul id="cs-expanded" class="cs-ul" aria-expanded="false">
                            <li class="cs-li">
                                <a href="{{ url_for('admin') }}" class="cs-li-link">
                                    <p class="cs-topper">Calendar</p>
                                </a>
                            </li>
                            <li class="cs-li">
                                <a href="{{ url_for('upload_pdf') }}" class="cs-li-link">
                                    <p class="cs-topper">Upload PDF</p>
                                </a>
                            </li>
                            <li class="cs-li">
                                <a href="{{ url_for('admin_usercontrol') }}" class="cs-li-link">
                                    <p class="cs-topper">Users</p>
                                </a>
                            </li>
                            <li class="cs-li">
                                <a href="{{ url_for('admin_bids') }}" class="cs-li-link">
                                    <p class="cs-topper">Bids</p>
                                </a>
                            </li>
                            <li class="cs-li">
                                <a href="{{ url_for('edit_profile') }}" class="cs-li-link">
                                    <p class="cs-topper">Account</p>
                                </a>
                            </li>

                        </ul>
                        {% elif session['user_role'] == 0%}
                        <ul id="cs-expanded" class="cs-ul" aria-expanded="false">
                            <li class="cs-li">
                                <a href="{{ url_for('subscriber') }}" class="cs-li-link">
                                    <p class="cs-topper">Calendar</p>
                                </a>
                            </li>
                            <li class="cs-li">
                                <a href="{{ url_for('my_bids') }}" class="cs-li-link">
                                    <p class="cs-topper">Bids</p>
                                </a>
                            </li>
                            <li class="cs-li">
                                <a href="{{ url_for('edit_profile') }}" class="cs-li-link">
                                    <p class="cs-topper">Account</p>
                                </a>
                            </li>
                            

                        </ul>
                        {% endif %}
                    </div>
                </nav>
            </div>
        </header>
        <br>
        <br>

        <section id="contact-718">
            <div class="cs-container">
                <div class="cs-content">
                    <span class="cs-topper">Place a bid on {{ property['addresses'] }}</span>
                    <form id="bid-form" class="cs-form" action="/submit_bid/{{ property_id }}" method="post">

                        <input type="hidden" name="id" value="{{ user['user_id'] }}">
                        <label class="cs-topper" for="username">User
                            <input class="cs-input" type="text" id="username" name="username"
                                value="{{ user['username'] }}" placeholder="Username" required readonly>
                        </label>

                        <label class="cs-topper" for="email">Email
                            <input class="cs-input" type="text" id="email" name="email" value="{{ user['email'] }}"
                                placeholder="email" required readonly>
                        </label>

                        <label class="cs-topper" for="phone">Phone
                            <input class="cs-input" type="text" id="phone" name="phone" value="{{ user['phone'] }}"
                                placeholder="phone" required readonly>
                        </label>

                        <label class="cs-topper" for="maximum-bid-amount">Maximum Bid Amount
                            <input class="cs-input" type="number" id="maximum-bid-amount" name="maximum-bid-amount"
                                value="{{ property['openingBid'] }}" min="{{ property['openingBid'] }}" required>
                        </label>
                        
                        <label class="cs-topper" for="fee">Fee*
                            <input class="cs-input" type="number" id="fee" name="fee" 
                                value="{{ fee }}" required readonly>
                        </label>

                        <label>
                            <input type="checkbox" name="terms" required>
                            I agree to the <a href="{{ url_for('bid_agreement') }}" target="_blank">Bidding Terms and Conditions</a>
                        </label>

                        <p style="font-size: small;">*Fee will be reduced if auction is won at lower price than maximum amount.</p>

                        <button class="cs-button-solid cs-submit" type="submit">Bid</button>
                    </form>
                </div>
            </div>
        </section>
    </div>
</body>

</html>